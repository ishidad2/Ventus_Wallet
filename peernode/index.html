<!DOCTYPE html>
<html>

<head>
  <title>Peer Node List</title>
  <style>
    body {
      margin-left: 40px;
    }

    /* テーブル全体の枠線スタイル */
    table {
      border-collapse: collapse;
      width: 1800px;
      table-layout: fixed;
      /* 列の幅を固定する */
    }

    /* ヘッダ行のスタイル */
    th {
      background-color: #fde8bf;
      text-align: left;
      white-space: nowrap;
      /* テキストを折り返さない */
      /*overflow: hidden;*/
      text-overflow: ellipsis;
    }

    /* セルのスタイル */
    th,
    td {
      border: 1px solid #000;
      padding: 8px;
      white-space: normal;
      /* テキストを折り返す */
      /* overflow: hidden;*/
      text-overflow: ellipsis;
    }

    /* 通し番号セルを右寄せに設定 */
    td.row-number {
      text-align: right;
    }

    /* 列の幅を固定 */
    td.col-1,
    th.col-1 {
      width: 2%;
      max-width: 2%;
      text-align: center;
      /* 中央配置 */
    }

    td.col-2,
    th.col-2 {
      width: 18%;
      max-width: 18%;
      text-align: center;
      /* 中央配置 */
    }

    td.col-3,
    th.col-3 {
      width: 15%;
      max-width: 15%;
      text-align: center;
      /* 中央配置 */
    }

    td.col-4,
    th.col-4 {
      width: 10%;
      max-width: 10%;
      text-align: center;
      /* 中央配置 */
    }

    td.col-5,
    th.col-5 {
      width: 5%;
      max-width: 5%;
      text-align: center;
      /* 中央配置 */
    }

    td.col-6,
    th.col-6 {
      width: 50%;
      max-width: 50%;
      text-align: center;
      /* 中央配置 */
    }

    .aLice_button {
      font-size: 20px;
      width: 200px;
      height: 40px;
      background-image: linear-gradient(45deg, #ffffff 0%, #69fe05 100%);
      color: rgb(255, 255, 255);
      border-radius: 16px;
      cursor: pointer;
      box-shadow: 2px 2px 2px rgb(102, 113, 102);
    }

    .aLice_button:hover {
      background-image: linear-gradient(45deg, #ffffff7f 0%, #ffffff7f 100%);
    }

    #date {
      font-family: 'Orbitron', sans-serif;
      font-size: 20px;
      color: #03a83a;
      text-shadow: 0 0 20px #0aafe6;
      line-height: 1.2;
    }

    #clock {
      font-family: 'Orbitron', sans-serif;
      font-size: 50px;
      color: #855DF7;
      text-shadow: 0 0 20px #0aafe6;
      line-height: 1.2;
      width: 200px;
      /* 時計の幅固定 */
      margin: 0px 30px 0px 0px;
      text-align: center;
    }

    .chain_height {
      font-family: 'Orbitron', sans-serif;
      font-size: 30px;
      color: #03a83a;
      text-shadow: 0 0 20px #0aafe6;
      line-height: 1.2;
    }

    .finalized_height {
      font-family: 'Orbitron', sans-serif;
      font-size: 30px;
      color: #6D77F6;
      text-shadow: 0 0 20px #0aafe6;
      line-height: 1.2;
    }
  </style>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <script src="https://code.jquery.com/jquery-3.7.1.slim.min.js"></script>
</head>

<body>
  <h1>SYMBOL</h1>
  <br>
  <div id="date"></div>
  <div id="clock"></div>
  <br>
  <button class="aLice_button"><a href="https://play.google.com/store/apps/details?id=com.pine.alice&pli=1"> aLice for
      Android</a></button>
  <button class="aLice_button"><a href="https://apps.apple.com/us/app/alice-sign/id6449146041">aLice for
      iOS</a></button>
  <button class="aLice_button"><a href="https://note.com/nononon_symbol/n/n87e8ef3f89e0"
      target="_blank">使い方</a></button>
  <br>
  <br>
  <br>
  <h2 style="text-align:left">Peer Node List (Main Net)</h2>
  <div
    style="font-family: 'Orbitron', sans-serif; font-size: 15px;color: #03a83a;text-shadow: 0 0 20px #0aafe6;line-height: 1.2;">
    Chain Height</div>
  <br>
  <div id="chain_height_M" class="chain_height"></div>
  <br>
  <div
    style="font-family: 'Orbitron', sans-serif; font-size: 15px;color: #6D77F6;text-shadow: 0 0 20px #0aafe6;line-height: 1.2;">
    Finalized Height</div>
  <br>
  <div id="finalized_height_M" class="finalized_height"></div>
  <br>

  <table id="data-table">
    <thead>
      <tr>
        <th class="col-1">#</th>
        <th class="col-2">FriendlyName</th>
        <th class="col-3">Host</th>
        <th class="col-4">Host Detail</th>
        <th class="col-5">Version</th>
        <th class="col-6">PublicKey</th>
      </tr>
    </thead>
    <tbody>
      <!-- 表データはここに挿入されます -->
    </tbody>
  </table>
  <br>
  <br>
  <h2 style="text-align:left">Peer Node List (Test Net)</h2>

  <div
    style="font-family: 'Orbitron', sans-serif; font-size: 15px;color: #03a83a;text-shadow: 0 0 20px #0aafe6;line-height: 1.2;">
    Chain Height</div>
  <br>
  <div id="chain_height_T" class="chain_height"></div>
  <br>
  <div
    style="font-family: 'Orbitron', sans-serif; font-size: 15px;color: #6D77F6;text-shadow: 0 0 20px #0aafe6;line-height: 1.2;">
    Finalized Height</div>
  <br>
  <div id="finalized_height_T" class="finalized_height"></div>
  <br>

  <table id="data-table2">
    <thead>
      <tr>
        <th class="col-1">#</th>
        <th class="col-2">FriendlyName</th>
        <th class="col-3">Host</th>
        <th class="col-4">Host Detail</th>
        <th class="col-5">Version</th>
        <th class="col-6">PublicKey</th>
      </tr>
    </thead>
    <tbody>
      <!-- 表データはここに挿入されます -->
    </tbody>
  </table>

  <script type="text/javascript" src="https://xembook.github.io/nem2-browserify/symbol-sdk-pack-2.0.4.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js"></script>
  <script>
    //const NODE = 'https://mikun-testnet.tk:3001'
    //const sym = require('/node_modules/symbol-sdk');
    //const repo = new sym.RepositoryFactoryHttp(NODE);
    //const accountRepo = repo.createAccountRepository();

    let URL = 'https://symbol.services/nodes'  // mainnet

    // fetch()を使用してデータを取得
    fetch(URL)
      .then((response) => {
        // レスポンスが成功したかどうかを確認
        if (!response.ok) {
          throw new Error(`Network response was not ok: ${response.status}`);
        }
        // JSONデータを解析して返す
        return response.json();
      })
      .then((data) => {
        // rolesプロパティが1の要素のみを抽出
        const filteredData = data.filter((item) => item.roles === 1);

        console.log("filterData==", filteredData)

        // テーブルのtbody要素を取得
        const tbody = document.querySelector('#data-table tbody');

        // 通し番号用の変数
        let rowNum = 0;
        let NET_Type;

        // 抽出したデータを表に挿入
        filteredData.forEach((item) => {
          if (item.hostDetail) {

            if (item.version === 16777989) {
              rowNum++; // 通し番号をインクリメント      
              const row = document.createElement('tr');
              row.innerHTML = `
              <td class="row-number"><a href="#" onclick="Num_Click('${item.friendlyName}', '${item.host}', '${item.hostDetail ? item.hostDetail.location : ''}', '${item.version}', '${item.publicKey}', 'MainNet');">${rowNum}</a></td>
              <td>${item.friendlyName}</td>
              <td>${item.host}</td>
              <td>${item.hostDetail.location}</td>
              <td>${item.version}</td>
              <td>${item.publicKey}</td>
            `;
              tbody.appendChild(row);
            }
            if (item.version === 16777990) {
              rowNum++; // 通し番号をインクリメント      
              const row = document.createElement('tr');
              row.innerHTML = `
              <td class="row-number"><a href="#" onclick="Num_Click('${item.friendlyName}', '${item.host}', '${item.hostDetail ? item.hostDetail.location : ''}', '${item.version}', '${item.publicKey}', 'MainNet');">${rowNum}</a></td>
              <td>${item.friendlyName}</td>
              <td>${item.host}</td>
              <td>${item.hostDetail.location}</td>
              <td>${item.version}</td>
              <td>${item.publicKey}</td>
            `;
              tbody.appendChild(row);
            }
          } else {
            if (item.version === 16777989) {
              rowNum++; // 通し番号をインクリメント
              const row = document.createElement('tr');
              row.innerHTML = `
              <td class="row-number"><a href="#" onclick="Num_Click('${item.friendlyName}', '${item.host}', 'Mobile 📱', '${item.version}', '${item.publicKey}', 'MainNet');">${rowNum}</a></td>
              <td>${item.friendlyName}</td>
              <td>${item.host}</td>
              <td>Mobile 📱</td>
              <td>${item.version}</td>
              <td>${item.publicKey}</td>
            `;
              tbody.appendChild(row);
            }
            if (item.version === 16777990) {
              rowNum++; // 通し番号をインクリメント
              const row = document.createElement('tr');
              row.innerHTML = `
              <td class="row-number"><a href="#" onclick="Num_Click('${item.friendlyName}', '${item.host}', '${item.hostDetail ? item.hostDetail.location : ''}', '${item.version}', '${item.publicKey}', 'MainNet');">${rowNum}</a></td>
              <td>${item.friendlyName}</td>
              <td>${item.host}</td>
              <td></td>
              <td>${item.version}</td>
              <td>${item.publicKey}</td>
            `;
              tbody.appendChild(row);
            }

          }

          // 特定の列の特定の数字の背景色を変更
          const cells = document.querySelectorAll('tbody td:nth-child(5)'); // Role列を選択

          cells.forEach((cell) => {
            if (cell.textContent === '16777989') { // 条件を確認
              cell.style.backgroundColor = 'aquamarine'; // 背景色を変更  
            }
            if (cell.textContent === '16777990') { // 条件を確認
              cell.style.backgroundColor = 'skyblue'; // 背景色を変更  
            }
          });
        });
      })
      .catch((error) => {
        // エラーが発生した場合はコンソールに表示
        console.error("Fetch error:", error);
      });

    ////////////////////////////////////////////////////////////////////////

    URL = 'https://2.dusanjp.com:3004/nodes'   // testnet
    // URL = 'https://testnet.symbol.services/nodes'   // testnet


    // fetch()を使用してデータを取得
    fetch(URL)
      .then((response) => {
        // レスポンスが成功したかどうかを確認
        if (!response.ok) {
          throw new Error(`Network response was not ok: ${response.status}`);
        }
        // JSONデータを解析して返す
        return response.json();
      })
      .then((data) => {
        // rolesプロパティが1の要素のみを抽出
        const filteredData = data.filter((item) => item.roles === 1);

        // テーブルのtbody要素を取得
        const tbody = document.querySelector('#data-table2 tbody');

        // 通し番号用の変数
        let rowNum = 0;

        // 抽出したデータを表に挿入
        filteredData.forEach((item) => {
          if (item.hostDetail) {
            if (item.version === 16777989) {
              rowNum++; // 通し番号をインクリメント      
              const row = document.createElement('tr');
              row.innerHTML = `
              <td class="row-number"><a href="#" onclick="Num_Click('${item.friendlyName}', '${item.host}', '${item.hostDetail ? item.hostDetail.location : ''}', '${item.version}', '${item.publicKey}', 'TestNet');">${rowNum}</a></td>
              <td>${item.friendlyName}</td>
              <td>${item.host}</td>
              <td>${item.hostDetail.location}</td>
              <td>${item.version}</td>
              <td>${item.publicKey}</td>
            `;
              tbody.appendChild(row);
            }
            if (item.version === 16777990) {
              rowNum++; // 通し番号をインクリメント      
              const row = document.createElement('tr');
              row.innerHTML = `
              <td class="row-number"><a href="#" onclick="Num_Click('${item.friendlyName}', '${item.host}', '${item.hostDetail ? item.hostDetail.location : ''}', '${item.version}', '${item.publicKey}', 'TestNet');">${rowNum}</a></td>
              <td>${item.friendlyName}</td>
              <td>${item.host}</td>
              <td>${item.hostDetail.location}</td>
              <td>${item.version}</td>
              <td>${item.publicKey}</td>
            `;
              tbody.appendChild(row);
            }
          } else {
            if (item.version === 16777989) {
              rowNum++; // 通し番号をインクリメント
              const row = document.createElement('tr');
              row.innerHTML = `
              <td class="row-number"><a href="#" onclick="Num_Click('${item.friendlyName}', '${item.host}', 'Mobile 📱', '${item.version}', '${item.publicKey}', 'TestNet');">${rowNum}</a></td>
              <td>${item.friendlyName}</td>
              <td>${item.host}</td>
              <td>Mobile 📱</td>
              <td>${item.version}</td>
              <td>${item.publicKey}</td>
            `;
              tbody.appendChild(row);
            }
            if (item.version === 16777990) {
              rowNum++; // 通し番号をインクリメント
              const row = document.createElement('tr');
              row.innerHTML = `
              <td class="row-number"><a href="#" onclick="Num_Click('${item.friendlyName}', '${item.host}', '${item.hostDetail ? item.hostDetail.location : ''}', '${item.version}', '${item.publicKey}', 'TestNet');">${rowNum}</a></td>
              <td>${item.friendlyName}</td>
              <td>${item.host}</td>
              <td></td>
              <td>${item.version}</td>
              <td>${item.publicKey}</td>
            `;
              tbody.appendChild(row);
            }

          }

          // 特定の列の特定の数字の背景色を変更
          const cells = document.querySelectorAll('tbody td:nth-child(5)'); // Role列を選択

          cells.forEach((cell) => {
            if (cell.textContent === '16777989') { // 条件を確認
              cell.style.backgroundColor = 'aquamarine'; // 背景色を変更  
            }
            if (cell.textContent === '16777990') { // 条件を確認
              cell.style.backgroundColor = "skyblue"; // 背景色を変更  
            }
          });
        });
      })
      .catch((error) => {
        // エラーが発生した場合はコンソールに表示
        console.error("Fetch error:", error);
      });

    function Num_Click(friendlyName, host, hostDetail, version, node_publicKey, NET_Type) {
      const arrayBuffer = new TextEncoder().encode(`https://ventus-wallet.tk/peernode/delegate.html?friendlyName=${encodeURIComponent(friendlyName)}&host=${encodeURIComponent(host)}&hostDetail=${encodeURIComponent(hostDetail)}&version=${encodeURIComponent(version)}&node_publicKey=${encodeURIComponent(node_publicKey)}&NET_Type=${encodeURIComponent(NET_Type)}`);
      const callback = Array.from(new Uint8Array(arrayBuffer), byte => byte.toString(16).padStart(2, '0')).join('').toUpperCase();
      const encodedUrl = `alice://sign?type=request_pubkey&callback=${callback}`;
      window.location.href = encodedUrl;
    }

    ////////////////////////////////// chain height   Finalize height < MainNet > ////////////////////

    const sym = require('/node_modules/symbol-sdk');
    let URL_M;
    let NODE_M;

    // エンドポイントのURL
    const endpointUrl_M = "https://symbol.services/nodes?filter=suggested&limit=3&ssl=true";

    // fetch()を使用してデータを取得
    fetch(endpointUrl_M)
      .then((response) => {
        // レスポンスが成功したかどうかを確認
        if (!response.ok) {
          throw new Error(`Network response was not ok: ${response.status}`);
        }
        // JSONデータを解析して返す
        return response.json();
      })
      .then((data) => {
        // JSONデータをコンソールに表示

        //console.log(data[0].host);
        URL_M = data[0].host;
        NODE_M = `https://${URL_M}:3001`

        const chainHttp = new sym.ChainHttp(NODE_M);
        const nodeHttp = new sym.NodeHttp(NODE_M);

        nodeHttp.getNodeInfo().subscribe(x => {
          $("#node_host").text(`🖥️ ${x.host} 🖥️`);
          console.log("x.host　", x.host.toString());
        });

        function updateData() {
          chainHttp.getChainInfo().subscribe(x => {
            $("#chain_height_M").text(`⛓️ ${x.height} ⛓️`);
            //console.log("x.height", x.height.toString());

            $("#finalized_height_M").text(`🔒 ${x.latestFinalizedBlock.height} 🔒`);
          });

        }

        // 最初の実行
        updateData();

        // 1秒ごとにデータを更新
        setInterval(updateData, 1000);

      })
      .catch((error) => {
        console.error("Fetch error:", error);
      });


    ////////////////////////////////// chain height   Finalize height < TestNet > ////////////////////

    //const sym = require('/node_modules/symbol-sdk');
    let URL_T;
    let NODE_T;

    // エンドポイントのURL
    const endpointUrl_T = "https://testnet.symbol.services/nodes?filter=suggested&limit=3&ssl=true";

    // fetch()を使用してデータを取得
    fetch(endpointUrl_T)
      .then((response) => {
        // レスポンスが成功したかどうかを確認
        if (!response.ok) {
          throw new Error(`Network response was not ok: ${response.status}`);
        }
        // JSONデータを解析して返す
        return response.json();
      })
      .then((data) => {
        // JSONデータをコンソールに表示

        //console.log(data[0].host);
        URL_T = data[0].host;
        NODE_T = `https://${URL_T}:3001`

        const chainHttp = new sym.ChainHttp(NODE_T);
        const nodeHttp = new sym.NodeHttp(NODE_T);

        nodeHttp.getNodeInfo().subscribe(x => {
          $("#node_host").text(`🖥️ ${x.host} 🖥️`);
          console.log("x.host　", x.host.toString());
        });

        function updateData() {
          chainHttp.getChainInfo().subscribe(x => {
            $("#chain_height_T").text(`⛓️ ${x.height} ⛓️`);
           //console.log("x.height", x.height.toString());

            $("#finalized_height_T").text(`🔒 ${x.latestFinalizedBlock.height} 🔒`);
          });

        }

        // 最初の実行
        updateData();

        // 1秒ごとにデータを更新
        setInterval(updateData, 1000);

      })
      .catch((error) => {
        console.error("Fetch error:", error);
      });

    function updateClock() {
      var now = new Date();
      var hours = now.getHours().toString().padStart(2, "0");
      var minutes = now.getMinutes().toString().padStart(2, "0");
      var seconds = now.getSeconds().toString().padStart(2, "0");
      var timeString = hours + ":" + minutes + ":" + seconds;

      document.getElementById("clock").textContent = timeString;

      var year = now.getFullYear();
      var month = (now.getMonth() + 1).toString().padStart(2, "0");
      var day = now.getDate().toString().padStart(2, "0");
      var daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      var dayOfWeek = daysOfWeek[now.getDay()]; // 曜日の短縮表記

      var dateString = year + "-" + month + "-" + day + " / " + dayOfWeek;

      document.getElementById("date").textContent = dateString;
    }

    // 初回の表示
    updateClock();

    // 1秒ごとに更新
    setInterval(updateClock, 1000);

  </script>
</body>

</html>